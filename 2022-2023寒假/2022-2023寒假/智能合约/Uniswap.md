# Uniswap

## (一）定义：

Uniswap是一种去中心化协议，无需订单簿或集中式中介即可执行。Uniswap通过流动性池模型实现了这一点，该模型使用自动智能合约，使潜在交易者能够获得竞争性用户资助的代币储备，作为市场流动性的主要来源。任何人都可以交换代币，将代币贡献到池中并赚取费用，或在Uniswap上列出代币。由于Uniswap建立在以太坊上，因此几乎任何ERC-20Token都可以使用Uniswap进行交换。此外，在Uniswap上交易的代币没有上市费——这与大多数集中式加密交易所的显著不同。

在传统市场中，订单簿编制交易所对任何资产的公开买入和卖出订单。如果买家愿意支付的价格与卖家愿意接受的价格之间存在巨大差距，那么由此导致交易活动的缺乏会导致流动性下降。这意味着，如果您持有受影响的资产，则出售将更加困难。Uniswap池通过创建交易资产库来最大限度地减少买方和卖方市场订单之间的这种错位，这反过来又有助于缓解潜在的市场流动性问题。此外，Uniswap的自动做市商技术通过算法分析流动性池，为特定交易提供最合适的价格。

当用户使用Uniswap流动性池进行交易时，该平台目前收取0.3%的交易费用。这个0.3%是UniswapV2中的交易手续费（1/6的费用是给Uniswap协议，5/6是给流动性提供者），在UniswapV3中采用费用层级方式（0.05%、0.3%、1%）进行不同代币收取费用优化。任何向Uniswap流动性池做出贡献的用户都会收到这些费用的一小部分，该费用与他们在整个池中的权益份额成比例。

Uniswap采用恒定乘积公式（x*y=k）,在此公式中，x和y都是表示市场对中一个代币总价值的变量。例如，x是ETH的总价值，y是协议的ETH/DAI流动性池中DAI的总价值。Uniswap将这两个数字相乘以确定k，k代表交易对的池流动性。Uniswap交易的核心要求是，即使x或y的值发生变化，资金池流动性也保持不变。因此，虽然每笔交易都会影响x和y的价格，但流动性保持不变。例如，如果交易者购买1ETH以换取330DAI，则流动性池中ETH的比率降低，而DAI比率增加以容纳池中少一个ETH和330个DAI代币。结果，ETH的价格将上涨，而DAI的价格会下跌。该公式确保了反映公平市场价值的维持，同时始终保持流动性。

Uniswap推出一种原生治理TokenUNI，可促进更大的社区参与和监督。UNI持有者可以对Uniswap项目开发进行投票，这些项目开发决定了平台的进化轨迹。UNI持有者还可以使用该代币为流动性矿池、赠款、合作伙伴关系和其他增长驱动的计划提供资金，用来扩大Uniswap的可用性和覆盖范围。随着Uniswap社区的发展，UNI控股的进一步多样化，创始团队将在设计平台治理中发挥越来越小的作用。这证明，权力下放和激励措施的统一概念，这两者都是DeFi革命的核心，正在被Uniswap付诸实践。

## （二）机制：

- 流动性
  
  V1：只能将ETH换成其他ERC20代币，如果想用USDT换取其他ERC20代币，先将USDT换成ETH，然后用ETH换其他代币。这样就支付了两次的gas，遭受两次滑点。
  
  V2：在V1中存在的ERC20/ETH池的基础上，增加了ERC20/ERC20流动性池，提取交易任何ERC20代币，不需要多次交换，减少gas和滑点风险。
  
  V3：在v2基础上，流动性代币采用了ERC721非同质化代币。

- 费用
  
  V1：手续费0.3%，然后再将费用进行再投入流动性资金池子。
  
  V2：手续费0.3%，其中0.05%是Uniswap协议的费用，剩下来的0.25%是给予流动性提供者。所得的费用进行再投资，就是进入流动性资金池，只有在移除流动性时候可以获取该费用。
  
  V3：手续费采用费用层级（0.05%、0.3%、1%），可以通过UNI治理开启其他费用，不同区间费用可以直接累加，不需要继续放进流动性池子，手动取出来。

- 预言机
  
  V1:不存在预言机制，因为V1的价格和现实世界密切相关，短时间内价格波动太大，不能安全的用作预言机。
  
  V2:采用TWAP时间加权平均价格预言机，通过测量和记录每个块的第一次交易之前的价格来改进此预言机功能，这个价格比起区块价格要难操纵。只提供了最新的价格累积值，开发者需要自己实现历史价格的记录和抓取。
  
  V3：相同交易对在不同费率时时不同的交易池，因此，改进的预言机不光记录了价格信息，还记录了流动性时间累积值。V3采用了几何平均值，比V2的算术平均值跟贴切数据稳定性。默认存储最近累积时间值，可以根据需要进行扩展，最多支持65535个历史价格信息（加上当前未被写入的价格信息，总计65536，存储按照环形数组存储，最后一个位置存储完，就存储在第一个位置，循环依次存储）。
