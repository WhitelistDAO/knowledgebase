1 Uniswap简介
1.1 Uniswap是什么
Uniswap is a protocol for automated token exchange on Ethereum. It is designed around ease-of-use, gas efficiency, censorship resistance, and zero rent extraction.
Uniswap是一个基于以太坊的自动代币交换协议，它的设计目标是：易用性、gas高利用率、抗审查性和零抽租。

Ease-Of-Use（易用性）: TokenA换TokenB，在Uniswap也只要发出一笔交易就能完成兑换，在其它交易所中可能需要发两笔交易：第一笔将TokenA换成某种媒介货币，如ETH, DAI 等，然后再发第二笔交易换成TokenB。
Gas Efficiency（gas高利用率）: 在Uniswap上消耗的gas量是以太坊上的几家主流去中化交易所中最低的，也就代表在Uniswap交易要付的矿工费最少。
Censorship Resistance（抗审查性）: 抗审查性体现在Uniswap上架新Token没有门槛，任何人都能在Uniswap上架任何Token。这在去中心交易所中很少见，虽然大多数的去中心化交易所不会像中心化交易所那样向你收取上币费，但还是需要提交上币申请，通过审查后运营团队才会让你的Token可以在他们的交易所上交易。
zero rent extraction（零抽租）: 在Uniswap协议设计中，开发团队不会从交易中抽取费用，交易中的所有费用都归还给流动性提供者。
1.2 Uniswap特点
A simple smart contract interface for swapping ERC20 tokens.
Uniswap是一种自动流动性协议，用于基于以太坊的ERC-20代币交换。
A formalized model for pooling liquidity reserves.
Uniswap采用了固定的算法，并在以太坊区块链上的不可升级智能合约系统中实施，它取消了对受信任的中介机构的需求，从而优先考虑了权力下放和安全性。
An open source frontend interface for traders and liquidity providers.
是一个为交易者和流动性提供者提供的开源的前端接口，基于GPL许可的开源软件。
A commitment to free and decentralized asset exchange
致力于免费且分布式的资产交换。每个Uniswap智能合约（或交易对合约）管理由两个ERC-20代币的储备组成的流动代币池。
2 做市
在前面的部分我们知道Uniswap可以实现将一种token换成另外一种token，那uniswap是怎么做到的呢？他和传统的做市商有什么区别呢？

2.1 传统市场上的交易
传统的交易所一般采用的是订单簿来撮合买卖双方，如下图所示:
[图片]
[图片]
简单来说就是：买方挂自己的购买数量和价格、卖方挂出自己的卖出数量和价格，交易所对买卖双方进行配对，当买价>=卖价时就促成交易，同时产生一个当前最新价。其特点是：
市场上必须要有用户进行挂单，没有订单就没有流动性（市场流动）。
订单必须重叠才能成交，即买价高于或等于卖价。
需要将资产存储在交易所。
2.2 做市商
传统的交易所（订单薄模型市场）中，买家期望买入某一资产，则卖家必须卖出同一种资产，并且要在价格上达成共识，而买家期望以最低的价格购买，卖家期望以最高的价格卖出，如果两者在价格上无法达成共识，那么将无法达成交易，此时如果想达成交易，要么是买家提价、要么是卖家降价，但当市场上此种资产的流通性较小时，价格达成共识将变得困难，市场流通性变差，此时就需要依靠做市商的参与。简单来说，做市商会在买卖两个方向上挂单，让交易得以达成，避免出现因一方没有挂单而导致流动性降低。资产的流动性对其价值影响极其巨大，如果资产无法在需要的时候变现，那么和白纸无异。在金融市场中，做市商扮演着非常重要的角色，它负责为市场提供充分的流动性，撮合买家和卖家以促成交易。
2017年涌现出的众多DEX都采用传统的订单簿形式(OrderBook)做市商，即由做市商在交易所中上不断创建和调整订单，等待对手吃单，因此也叫被动做市商。
3 Uniswap上的交易
Uniswap是一个运行在以太坊区块链上的流动性协议，支持免信任的代币互换，也即是说，该交易所上的所有交易都是由智能合约自动执行的，用户无需依靠某个中介也无需信任某个第三方。
3.1 提供流动性
在uniswap上，我们也可以查看当前的流动性情况
[图片]
我们可以为某一个交易对增加流动性，点击图中「增加流动性」按钮；也可以看某一个交易对流动性的详细信息，如下图所示：
[图片]
上述的操作可以通过api来实现，Uniswap是一种基于以太坊的协议，旨在促进ETH和ERC20 代币数字资产之间的自动兑换交易。Uniswap完全部署在链上，任何个人用户，只要安装了去中心化钱包软件（当前已经支持的钱包包括MetaMask、WalletConnect、Coinbase Wallet、Fortmatic、Portis），都可以使用这个协议。
3.2 换币
在uniswap上我们可以方便的将我们的ERC20 token换成另外一种ERC20 token，如下所示：
[图片]
4 uniswap交易做市原理
4.1 整体模型
以Dai-ETH交易对为例，其整体模型如下：
[图片]
任何人可以在uniswap上建立一个双币种之间兑换的池子，由创建者往这个池子里添加这两个币种，添加的数量由第一个创建者决定。池子的创建者也属于流动性提供者。
做市商即流动性添加者。以DAI-ETH的池子为例，做市商往池子里添加这两种币种，并获得LP Token（做市凭证）。
在做市商提供了流动性以后，用户就可以和这个池子进行交易了，可以选择把DAI换成ETH，也可以把ETH换成DAI。
交易的过程中，需要给流动性提供者支付手续费，目前是收取支付币种的0.3%。由于交易用户的手续费直接全部分给做市商，吸引了大资金的玩家进入uniswap提供流动性，大资金的进入会使得用户在交易的时候以更优的价格进行成交，进一步吸引用户进入uniswap进行交易，繁荣了交易的生态。
LP token用于跟踪用户资产在总资产池的比率，当用户取消做市时，通过LP token确定赎回资产的份额，同时将LP Token换成DAI和ETH，并同时获得做市期间获得的交易手续费。
4.2 智能合约
Uniswap是通过智能合约来管理两种ERC20代币组成的代币池，每一笔存入、兑换记录都可查可追溯。
4.3 AMM（Automated Market Maker，自动化做市机制）
4.3.1 恒定乘积
对uniswap中的任意一个代币交易对，其都遵守：
x*y=k
公式，x、y分别代表交易对的两种代币。协议保证:
当用户要从一个资金池中换出资产时，交易前和交易后池内两种资产的具体数量的乘积相等。
此公式的曲线图如下所示：

[图片]
从上述图可以看出，由于曲线的斜率是变化的，当交易的数量不同时，价格是不同的。假设交易使得池子里的数量从old position点移动到了new position点，交易的价格等于A tokens spent/B tokens spent（ price=△x /△y ）。从图可得，若支付2倍的A token，获得的B token小于原来的2倍，根据公式可得价格是变大的。
此机制的核心在于：
报价直接取决于订单的大小
越往曲线右端移动，单位投入获得的收益越少
4.3.2 价格变动推演(不考虑手续费)
接下来以ETH/DAI交易对为例，推演一下在进行代币兑换过程中，两种代币的价格变化。假设做市商已经为这一流动性池注入了10000 DAI(x)和100 ETH(y)的资金，初始时k = 10000 x 100 = 1,000,000。根据公式x*y=k可知，在代币兑换过程中，x、y不断变化，但是k一直保持不变。
4.3.3 价格变动推演(考虑手续费)
为了鼓励用于向Uniswap的流动池中提供更多的流动性，Uniswap会从每笔交易总额中抽取0.3%当成交易手续费，并将手续费全额交给那些将注资金到Uniswap资金池提供流动性的流动性提供者。Uniswap需要手续的地方包括：
用ETH兑换ERC20代币，其手续费为ETH的0.3%；
ERC20代币兑换ETH，其手续费为ERC20代币的0.3%；
Uniswap v1中，ERC20代币兑换ERC20代币，其手续费包括了两部分：一是从ERC20代币兑换为ETH的交易，手续费为ERC20代币的0.3%；从将兑换来的ETH兑换为新ERC20代币，手续费为ETH的0.3%。
注意：Uniswap v1中所有的换币操作都要以ETH为媒介，不过在Uniswap v2中，不依赖ETH就可以换币。
5.
Uniswap协议本质是在抢交易所的生意，用户不用依赖任何交易所即可完成代币之间的兑换；在Uniswap上，无需挂买单或卖单，也不用进行繁重的计算。流动性提供者也可以一劳永逸，订单和仓位管理方面的开销也明显减少。
值得注意的一点是：既然可以不依赖交易所就能完成代币兑换，那么必然可以实现发币功能，即，可以简单地认为，即便是没有任何中心化的交易所，也可以发币了。当然uniswap上的发币还是有一些规则和规范的。
对于用户而言，uniswap提供了两种能力：
对于希望通过提供流动性来进行获益的用户而言，用户可以将自己拥有的ERC20存入uniswap的流动性提供池，通过提供流动性而获益。
对于需要流动性的用户而言，用户可以在uniswap上将自己的一种ERC20 token换成另外一种ERC20 token，这个过程中不用有任何人挂卖单，因为另一种token由流动性提供者提供。
s